{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"PyBroker \u4ecb\u7ecd","text":"<p>\u4f60\u662f\u5426\u5e0c\u671b\u501f\u52a9 Python \u548c\u673a\u5668\u5b66\u4e60\u7684\u529b\u91cf\u6765\u4f18\u5316\u60a8\u7684\u4ea4\u6613\u7b56\u7565\uff1f \u90a3\u4e48\u4f60\u9700\u8981\u4e86\u89e3\u4e00\u4e0b PyBroker\uff01\u8fd9\u4e2a Python \u6846\u67b6\u4e13\u4e3a\u5f00\u53d1\u7b97\u6cd5\u4ea4\u6613\u7b56\u7565\u800c\u8bbe\u8ba1\uff0c \u5c24\u5176\u5173\u6ce8\u4f7f\u7528\u673a\u5668\u5b66\u4e60\u7684\u7b56\u7565\u3002\u501f\u52a9 PyBroker\uff0c\u4f60\u53ef\u4ee5\u8f7b\u677e\u521b\u5efa\u548c\u5fae\u8c03\u4ea4\u6613\u89c4\u5219\uff0c \u6784\u5efa\u5f3a\u5927\u7684\u6a21\u578b\uff0c\u5e76\u6df1\u5165\u4e86\u89e3\u4f60\u7684\u7b56\u7565\u8868\u73b0\u3002</p> <p>PyBroker \u9879\u76ee GitHub \u5730\u5740</p> <p>PyBroker \u82f1\u6587\u6587\u6863\u5730\u5740\uff1a\u70b9\u51fb\u8fdb\u5165\u82f1\u6587\u6587\u6863</p> <p>PyBroker \u4e2d\u6587\u6587\u6863\u5730\u5740\uff1a\u70b9\u51fb\u8fdb\u5165\u4e2d\u6587\u6587\u6863</p>"},{"location":"#_1","title":"\u5b89\u88c5","text":"<pre><code>pip install lib-pybroker --upgrade\n</code></pre>"},{"location":"#_2","title":"\u73af\u5883\u914d\u7f6e","text":"<p>PyBroker \u652f\u6301\u5728 Windows\u3001macOS \u548c Linux \u4e2d\u7684 Python 3.9\uff08\u5efa\u8bae\u4f7f\u7528 Python 3.11\uff09\u53ca\u4ee5\u4e0a\u7248\u672c\u4f7f\u7528\u3002</p>"},{"location":"#_3","title":"\u7b56\u7565\u793a\u4f8b","text":"demo.py<pre><code># \u5bfc\u5165\u6240\u9700\u7684\u5e93\u548c\u6a21\u5757\nimport pybroker as pb\nfrom pybroker import Strategy, ExecContext\nfrom pybroker.ext.data import AKShare\n\n# \u5b9a\u4e49\u5168\u5c40\u53c2\u6570 \"stock_code\"\uff08\u80a1\u7968\u4ee3\u7801\uff09\u3001\"percent\"\uff08\u6301\u4ed3\u767e\u5206\u6bd4\uff09\u548c \"stop_profit_pct\"\uff08\u6b62\u76c8\u767e\u5206\u6bd4\uff09\npb.param(name='stock_code', value='600000')\npb.param(name='percent', value=1)\npb.param(name='stop_loss_pct', value=10)\npb.param(name='stop_profit_pct', value=10)\n\n# \u521d\u59cb\u5316 AKShare \u6570\u636e\u6e90\nakshare = AKShare()\n\n# \u4f7f\u7528 AKShare \u6570\u636e\u6e90\u67e5\u8be2\u7279\u5b9a\u80a1\u7968\uff08\u7531 \"stock_code\" \u53c2\u6570\u6307\u5b9a\uff09\u5728\u6307\u5b9a\u65e5\u671f\u8303\u56f4\u5185\u7684\u6570\u636e\ndf = akshare.query(symbols=[pb.param(name='stock_code')], start_date='20200131', end_date='20230228')\n\n\n# \u5b9a\u4e49\u4ea4\u6613\u7b56\u7565\uff1a\u5982\u679c\u5f53\u524d\u6ca1\u6709\u6301\u6709\u8be5\u80a1\u7968\uff0c\u5219\u4e70\u5165\u80a1\u7968\uff0c\u5e76\u8bbe\u7f6e\u6b62\u76c8\u70b9\u4f4d\ndef buy_with_stop_loss(ctx: ExecContext):\n    pos = ctx.long_pos()\n    if not pos:\n        # \u8ba1\u7b97\u76ee\u6807\u80a1\u7968\u6570\u91cf\uff0c\u6839\u636e \"percent\" \u53c2\u6570\u786e\u5b9a\u5e94\u8d2d\u4e70\u7684\u80a1\u7968\u6570\u91cf\n        ctx.buy_shares = ctx.calc_target_shares(pb.param(name='percent'))\n        ctx.hold_bars = 100\n    else:\n        ctx.sell_shares = pos.shares\n        # \u8bbe\u7f6e\u6b62\u76c8\u70b9\u4f4d\uff0c\u6839\u636e \"stop_profit_pct\" \u53c2\u6570\u786e\u5b9a\u6b62\u76c8\u70b9\u4f4d\n        ctx.stop_profit_pct = pb.param(name='stop_profit_pct')\n\n\n# \u521b\u5efa\u7b56\u7565\u914d\u7f6e\uff0c\u521d\u59cb\u8d44\u91d1\u4e3a 500000\nmy_config = pb.StrategyConfig(initial_cash=500000)\n# \u4f7f\u7528\u914d\u7f6e\u3001\u6570\u636e\u6e90\u3001\u8d77\u59cb\u65e5\u671f\u3001\u7ed3\u675f\u65e5\u671f\uff0c\u4ee5\u53ca\u521a\u624d\u5b9a\u4e49\u7684\u4ea4\u6613\u7b56\u7565\u521b\u5efa\u7b56\u7565\u5bf9\u8c61\nstrategy = Strategy(akshare, start_date='20200131', end_date='20230228', config=my_config)\n# \u6dfb\u52a0\u6267\u884c\u7b56\u7565\uff0c\u8bbe\u7f6e\u80a1\u7968\u4ee3\u7801\u548c\u8981\u6267\u884c\u7684\u51fd\u6570\nstrategy.add_execution(fn=buy_with_stop_loss, symbols=[pb.param(name='stock_code')])\n# \u6267\u884c\u56de\u6d4b\uff0c\u5e76\u6253\u5370\u51fa\u56de\u6d4b\u7ed3\u679c\u7684\u5ea6\u91cf\u503c\uff08\u56db\u820d\u4e94\u5165\u5230\u5c0f\u6570\u70b9\u540e\u56db\u4f4d\uff09\nresult = strategy.backtest()\nprint(result.metrics_df.round(4))\n</code></pre> shell<pre><code>Loading bar data...\nLoaded bar data: 0:00:00 \nBacktesting: 2020-01-31 00:00:00 to 2023-02-28 00:00:00\nLoading bar data...\nLoaded bar data: 0:00:00 \nTest split: 2020-02-03 00:00:00 to 2023-02-28 00:00:00\n100% (748 of 748) |######################| Elapsed Time: 0:00:00 Time:  0:00:00\nFinished backtest: 0:00:03\n                      name        value\n0              trade_count     373.0000\n1     initial_market_value  500000.0000\n2         end_market_value  467328.0900\n3                total_pnl  -33322.7800\n4           unrealized_pnl     650.8700\n5         total_return_pct      -6.6646\n6             total_profit  530528.5100\n7               total_loss -563851.2900\n8               total_fees       0.0000\n9             max_drawdown -113004.2700\n10        max_drawdown_pct     -20.2704\n11                win_rate      45.9215\n12               loss_rate      54.0785\n13          winning_trades     152.0000\n14           losing_trades     179.0000\n15                 avg_pnl     -89.3372\n16          avg_return_pct      -0.0160\n17          avg_trade_bars       1.0000\n18              avg_profit    3490.3191\n19          avg_profit_pct       0.6958\n20  avg_winning_trade_bars       1.0000\n21                avg_loss   -3150.0072\n22            avg_loss_pct      -0.6241\n23   avg_losing_trade_bars       1.0000\n24             largest_win   31157.9400\n25         largest_win_pct       5.9200\n26        largest_win_bars       1.0000\n27            largest_loss  -12682.6000\n28        largest_loss_pct      -2.3100\n29       largest_loss_bars       1.0000\n30                max_wins       8.0000\n31              max_losses       7.0000\n32                  sharpe      -0.0132\n33                 sortino      -0.0231\n34           profit_factor       0.9638\n35             ulcer_index       1.7639\n36                     upi      -0.0039\n37               equity_r2       0.5876\n38               std_error   27448.1177\n</code></pre>"},{"location":"article/","title":"\u5173\u4e8e PyBroker \u7684\u6559\u7a0b\u96c6\u5408","text":""},{"location":"article/#_1","title":"\u4e2d\u6587\u6559\u7a0b","text":"<ol> <li>PyBroker\uff1a\u4e3a\u673a\u5668\u5b66\u4e60\u800c\u751f\u7684\u91cf\u5316\u56de\u6d4b\u6846\u67b6</li> </ol>"},{"location":"article/#_2","title":"\u82f1\u6587\u6559\u7a0b","text":"<ol> <li>Algorithmic Trading in Python with Machine Learning: Walkforward Analysis</li> <li>Rotational Trading in Python</li> </ol>"},{"location":"contributing/","title":"\u8d21\u732e\u6e90\u4ee3\u7801","text":""},{"location":"contributing/#_2","title":"\u73af\u5883\u642d\u5efa","text":""},{"location":"contributing/#_3","title":"\u5b89\u88c5\u4f9d\u8d56","text":"<ul> <li>\u514b\u9686\u9879\u76ee\u5230\u672c\u5730\u540e\uff0c\u8fdb\u5165\u9879\u76ee\u76ee\u5f55\u3002</li> <li> <p>\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5\u9879\u76ee\u4f9d\u8d56\uff1a</p> <pre><code>pip install -r requirements.txt\n</code></pre> </li> </ul>"},{"location":"contributing/#pre-commit-ruff","title":"\u5b89\u88c5 pre-commit \u548c ruff","text":"<ul> <li>\u9879\u76ee\u4f7f\u7528 pre-commit \u8fdb\u884c\u4ee3\u7801\u98ce\u683c\u68c0\u67e5\u548c\u683c\u5f0f\u5316\uff0c\u4f7f\u7528 ruff \u8fdb\u884c\u4ee3\u7801\u8d28\u91cf\u68c0\u67e5\u3002</li> <li> <p>\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5 pre-commit \u548c ruff\uff1a</p> <pre><code>pip install pre-commit ruff\n</code></pre> </li> <li> <p>\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5 pre-commit \u7684 Git \u94a9\u5b50\uff1a      <pre><code>pre-commit install\n</code></pre></p> </li> </ul>"},{"location":"contributing/#_4","title":"\u8d21\u732e\u6d41\u7a0b","text":""},{"location":"contributing/#fork","title":"Fork \u9879\u76ee","text":"<ul> <li>\u8bbf\u95ee akfamily/akquant \u9879\u76ee\u7684 GitHub \u4e3b\u9875\uff1ahttps://github.com/akfamily/akquant</li> <li>\u70b9\u51fb\u9875\u9762\u53f3\u4e0a\u89d2\u7684 \"Fork\" \u6309\u94ae\u3002</li> <li>GitHub \u4f1a\u5c06\u9879\u76ee\u590d\u5236\u5230\u60a8\u81ea\u5df1\u7684\u8d26\u6237\u4e0b\uff0c\u521b\u5efa\u4e00\u4e2a\u60a8\u53ef\u4ee5\u7f16\u8f91\u7684\u526f\u672c\u3002</li> </ul>"},{"location":"contributing/#clone","title":"Clone \u9879\u76ee\u5230\u672c\u5730","text":"<ul> <li>\u5728\u60a8\u7684 GitHub \u8d26\u6237\u4e0b\uff0c\u8fdb\u5165\u521a\u521a fork \u7684 akquant \u9879\u76ee\u3002</li> <li>\u70b9\u51fb \"Code\" \u6309\u94ae\uff0c\u590d\u5236\u9879\u76ee\u7684 HTTPS \u6216 SSH \u5730\u5740\u3002</li> <li>\u6253\u5f00\u7ec8\u7aef\uff0c\u5bfc\u822a\u5230\u60a8\u60f3\u8981\u5b58\u653e\u9879\u76ee\u7684\u672c\u5730\u76ee\u5f55\u3002</li> <li> <p>\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u5c06\u9879\u76ee\u514b\u9686\u5230\u672c\u5730\uff1a</p> <pre><code>git clone https://github.com/YourUsername/akquant.git\n</code></pre> </li> <li> <p>\u5c06 <code>YourUsername</code> \u66ff\u6362\u4e3a\u60a8\u7684 GitHub \u7528\u6237\u540d\u3002</p> </li> </ul>"},{"location":"contributing/#_5","title":"\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5206\u652f","text":"<ul> <li> <p>\u8fdb\u5165\u9879\u76ee\u76ee\u5f55\uff1a</p> <pre><code>cd akquant\n</code></pre> </li> <li> <p>\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5206\u652f\u6765\u8fdb\u884c\u60a8\u7684\u4fee\u6539\uff1a</p> <pre><code>git checkout -b my-feature\n</code></pre> </li> <li> <p>\u5c06 <code>my-feature</code> \u66ff\u6362\u4e3a\u60a8\u8981\u5f00\u53d1\u7684\u529f\u80fd\u6216\u4fee\u590d\u7684\u540d\u79f0\u3002</p> </li> </ul>"},{"location":"contributing/#_6","title":"\u8fdb\u884c\u4fee\u6539\u5e76\u63d0\u4ea4","text":"<ul> <li>\u4f7f\u7528\u60a8\u559c\u6b22\u7684\u7f16\u8f91\u5668\u6216 IDE \u5bf9\u9879\u76ee\u8fdb\u884c\u4fee\u6539\u6216\u6dfb\u52a0\u65b0\u529f\u80fd\u3002</li> <li> <p>\u5b8c\u6210\u4fee\u6539\u540e\uff0c\u63d0\u4ea4\u60a8\u7684\u66f4\u6539:</p> <pre><code>git add .\ngit commit -m \"\u6dfb\u52a0\u4e86\u65b0\u529f\u80fd\"\n</code></pre> </li> <li> <p>\u63d0\u4ea4\u4fe1\u606f\u5e94\u8be5\u7b80\u6d01\u660e\u4e86\u5730\u63cf\u8ff0\u60a8\u6240\u505a\u7684\u66f4\u6539\u3002</p> </li> <li>pre-commit \u4f1a\u5728\u63d0\u4ea4\u65f6\u81ea\u52a8\u8fd0\u884c\u4ee3\u7801\u98ce\u683c\u68c0\u67e5\u548c\u683c\u5f0f\u5316\u3002</li> </ul>"},{"location":"contributing/#github","title":"\u63a8\u9001\u5230\u60a8\u7684 GitHub \u4ed3\u5e93","text":"<ul> <li> <p>\u5c06\u672c\u5730\u7684\u4fee\u6539\u63a8\u9001\u5230\u60a8\u7684 GitHub \u4ed3\u5e93\uff1a</p> <pre><code>git push origin my-feature\n</code></pre> </li> <li> <p>\u5c06 <code>my-feature</code> \u66ff\u6362\u4e3a\u60a8\u4e4b\u524d\u521b\u5efa\u7684\u5206\u652f\u540d\u79f0\u3002</p> </li> </ul>"},{"location":"contributing/#pull-request","title":"\u521b\u5efa Pull Request","text":"<ul> <li>\u5728\u60a8\u7684 akquant \u9879\u76ee\u9875\u9762\u4e0a\uff0c\u70b9\u51fb \"Compare &amp; pull request\" \u6309\u94ae\u3002</li> <li>\u786e\u4fdd \"base repository\" \u662f <code>akfamily/akquant</code>\uff0c\u800c \"head repository\" \u662f\u60a8\u81ea\u5df1\u7684\u4ed3\u5e93\u3002</li> <li>\u586b\u5199 Pull Request \u7684\u6807\u9898\u548c\u63cf\u8ff0\uff0c\u63d0\u4f9b\u5173\u4e8e\u60a8\u6240\u505a\u4fee\u6539\u7684\u8be6\u7ec6\u4fe1\u606f\u3002</li> <li>\u70b9\u51fb \"Create Pull Request\" \u6309\u94ae\u63d0\u4ea4\u3002</li> </ul>"},{"location":"contributing/#_7","title":"\u7b49\u5f85\u5ba1\u6838\u548c\u5408\u5e76","text":"<ul> <li>akquant \u9879\u76ee\u7684\u7ef4\u62a4\u8005\u5c06\u5ba1\u6838\u60a8\u7684 Pull Request\uff0c\u5e76\u53ef\u80fd\u4f1a\u63d0\u4f9b\u53cd\u9988\u6216\u8981\u6c42\u8fdb\u4e00\u6b65\u7684\u4fee\u6539\u3002</li> <li>\u5982\u679c\u9700\u8981\u8fdb\u884c\u66f4\u6539\uff0c\u53ef\u4ee5\u5728\u672c\u5730\u8fdb\u884c\u4fee\u6539\u3002\u7136\u540e\u91cd\u590d\u6b65\u9aa4 4-5\uff0c\u5c06\u4fee\u6539\u63a8\u9001\u5230\u60a8\u7684\u4ed3\u5e93\u3002</li> <li>\u4e00\u65e6\u60a8\u7684 Pull Request \u88ab\u63a5\u53d7\u5e76\u5408\u5e76\uff0c\u60a8\u7684\u8d21\u732e\u5c06\u6210\u4e3a akquant \u9879\u76ee\u7684\u4e00\u90e8\u5206\u3002</li> </ul>"},{"location":"contributing/#_8","title":"\u603b\u7ed3","text":"<p>\u5e0c\u671b\u4ee5\u4e0a\u8be6\u7ec6\u7684\u6b65\u9aa4\u80fd\u4e3a\u60a8\u8d21\u732e akquant \u9879\u76ee\u63d0\u4f9b\u6307\u5bfc\u3002 \u5982\u679c\u60a8\u6709\u4efb\u4f55\u5176\u4ed6\u95ee\u9898\uff0c\u6b22\u8fce\u968f\u65f6\u5411\u9879\u76ee\u7ef4\u62a4\u8005\u63d0\u51fa\u3002\u795d\u60a8\u8d21\u732e\u987a\u5229!</p>"},{"location":"data-source/","title":"\u4f7f\u7528\u6570\u636e\u6e90","text":""},{"location":"data-source/#_2","title":"\u81ea\u5b9a\u4e49\u6570\u636e\u6e90","text":"<p>PyBroker \u63d0\u4f9b\u4e86\u81ea\u5b9a\u4e49\u6570\u636e\u6e90\u7684\u529f\u80fd\uff0c\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u65b9\u5f0f\u81ea\u5b9a\u4e49\u6570\u636e\u6e90\uff1a</p> ds_01.py<pre><code>import pandas as pd\nimport pybroker as pb\n# \u4ece pybroker.data \u6a21\u5757\u4e2d\u5bfc\u5165 DataSource \u7c7b\uff0c\u8fd9\u4e2a\u7c7b\u662f\u4e00\u4e2a\u62bd\u8c61\u57fa\u7c7b\nfrom pybroker.data import DataSource\n\n# \u5b9a\u4e49\u4e00\u4e2a\u540d\u4e3a CSVDataSource \u7684\u7c7b\uff0c\u8be5\u7c7b\u7ee7\u627f\u81ea DataSource\n# \u8fd9\u4e2a\u7c7b\u4ee3\u8868\u4e86\u4e00\u4e2a\u4ece CSV \u6587\u4ef6\u4e2d\u68c0\u7d22\u6570\u636e\u7684\u6570\u636e\u6e90\nclass CSVDataSource(DataSource):\n\n    # CSVDataSource \u7c7b\u7684\u6784\u9020\u65b9\u6cd5\n    def __init__(self):\n        # \u8c03\u7528\u7236\u7c7b DataSource \u7684\u6784\u9020\u65b9\u6cd5\uff0c\u4ee5\u6b63\u786e\u521d\u59cb\u5316\u7ee7\u627f\u7684\u5c5e\u6027\u6216\u65b9\u6cd5\n        super().__init__()\n        # \u5728 pybroker \u7cfb\u7edf\u4e2d\u6ce8\u518c\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\u5217\u6807\u8bc6\u7b26 'rsi'\n        # \u8fd9\u8868\u660e 'rsi'\uff08\u76f8\u5bf9\u5f3a\u5f31\u6307\u6570\uff09\u662f CSV \u6570\u636e\u4e2d\u7684\u4e00\u4e2a\u5217\u540d\uff0c\u9700\u8981\u88ab pybroker \u8bc6\u522b\n        pybroker.register_columns('rsi')\n\n    # \u5b9a\u4e49\u4e00\u4e2a\u53d7\u4fdd\u62a4\u7684\u65b9\u6cd5\u6765\u4ece CSV \u6587\u4ef6\u4e2d\u83b7\u53d6\u6570\u636e\n    # \u8fd9\u4e2a\u65b9\u6cd5\u63a5\u53d7\u7b26\u53f7\u3001\u5f00\u59cb\u65e5\u671f\u3001\u7ed3\u675f\u65e5\u671f\u3001_timeframe \u548c _adjust \u4f5c\u4e3a\u53c2\u6570\n    def _fetch_data(self, symbols, start_date, end_date, _timeframe, _adjust):\n        # \u5c06 CSV \u6570\u636e\u8bfb\u5165\u4e00\u4e2a pandas DataFrame\u3002pandas \u7279\u522b\u9002\u5408\u5904\u7406 CSV \u6570\u636e\n        df = pd.read_csv('data/prices.csv')\n        # \u8fc7\u6ee4 DataFrame\uff0c\u53ea\u5305\u542b 'symbol' \u5217\u4e0e\u53c2\u6570\u4e2d\u63d0\u4f9b\u7684\u7b26\u53f7\u5339\u914d\u7684\u884c\n        df = df[df['symbol'].isin(symbols)]\n        # \u5c06 DataFrame \u4e2d\u7684 'date' \u5217\u8f6c\u6362\u4e3a pandas \u7684 datetime \u5bf9\u8c61\uff0c\u4ee5\u4fbf\u66f4\u597d\u5730\u5904\u7406\u65e5\u671f\n        df['date'] = pd.to_datetime(df['date'])\n        # \u8fd4\u56de\u4e00\u4e2a DataFrame\uff0c\u5176\u4e2d\u5305\u542b\u6307\u5b9a\u5f00\u59cb\u548c\u7ed3\u675f\u65e5\u671f\u4e4b\u95f4\u7684\u884c\n        return df[(df['date'] &gt;= start_date) &amp; (df['date'] &lt;= end_date)]\n</code></pre>"},{"location":"fin-data/","title":"\u8d22\u7ecf\u6570\u636e\u6e90","text":""},{"location":"fin-data/#_2","title":"\u5f00\u6e90\u8d22\u7ecf\u6570\u636e\u63a5\u53e3\u5e93","text":"<ol> <li>AKShare</li> <li>YFinance</li> <li>Tushare</li> </ol>"},{"location":"fin-data/#_3","title":"\u56fd\u5185\u8d22\u7ecf\u6570\u636e\u6e90","text":"<p>\u56fd\u5185\u7684\u8d22\u7ecf\u6570\u636e\u6e90\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\uff1a</p> <ol> <li>\u4e1c\u65b9\u8d22\u5bcc</li> <li>\u540c\u82b1\u987a</li> <li>\u65b0\u6d6a\u8d22\u7ecf</li> <li>\u817e\u8baf\u8d22\u7ecf</li> <li>\u96ea\u7403</li> <li>\u91d1\u878d\u754c</li> <li>\u805a\u5bbd</li> <li>\u7c73\u7b50</li> <li>\u5929\u52e4</li> <li>\u4f18\u77ff</li> <li>\u6398\u91d1</li> <li>\u4e07\u77ff</li> <li>\u901a\u8054\u6570\u636e</li> <li>\u6052\u6709\u6570</li> <li>\u8baf\u6295\u7814</li> </ol> <p>\u56fd\u5185\u5546\u4e1a\u53ca\u5b66\u672f\u7814\u7a76\u6570\u636e\u6e90\uff1a</p> <ol> <li>CSMAR</li> <li>Wind</li> <li>CNRDS</li> </ol>"},{"location":"installation/","title":"PyBroker \u5b89\u88c5","text":"<p>PyBroker \u76ee\u524d\u652f\u6301\u5728 Windows\uff0cmacOS \u548c Linux \u4e2d Python 3.9 \u53ca\u4ee5\u4e0a\u7248\u672c\uff0c \u5efa\u8bae\u4f7f\u7528 Python 3.12 \u53ca\u4ee5\u4e0a\u7248\u672c\u4e2d\u8fdb\u884c\u5b89\u88c5\u548c\u4f7f\u7528\u3002</p> <p>\u6b64\u5904 Windows \u7528\u6237\u9700\u8981\u6ce8\u610f\uff0cWindows 10 \u53ca\u4ee5\u4e0a\u7248\u672c\u624d\u652f\u6301 Python 3.9 \u53ca\u4ee5\u4e0a\u7248\u672c\u3002</p> <p>\u7531\u4e8e PyBroker \u9700\u8981\u5b89\u88c5\u7684\u4f9d\u8d56\u5e93\u6bd4\u8f83\u591a\uff0c \u56e0\u6b64\u5b89\u88c5\u8fc7\u7a0b\u53ef\u80fd\u4f1a\u6bd4\u8f83\u6162\uff0c \u5efa\u8bae\u4f7f\u7528 \u6e05\u534e\u955c\u50cf\u6e90 \u8fdb\u884c\u5b89\u88c5\u3002</p>"},{"location":"installation/#pip","title":"PIP \u5b89\u88c5","text":""},{"location":"installation/#pypi","title":"PyPI \u955c\u50cf\u6e90\u5b89\u88c5","text":"<pre><code>pip install lib-pybroker -i https://pypi.org/simple\n</code></pre>"},{"location":"installation/#_1","title":"\u6e05\u534e\u955c\u50cf\u6e90\u5b89\u88c5","text":"<pre><code>pip install lib-pybroker -i https://pypi.tuna.tsinghua.edu.cn/simple\n</code></pre>"},{"location":"installation/#pip_1","title":"PIP \u5347\u7ea7","text":""},{"location":"installation/#pypi_1","title":"PyPI \u955c\u50cf\u6e90\u5347\u7ea7","text":"<pre><code>pip install -U lib-pybroker -i https://pypi.org/simple\n</code></pre>"},{"location":"installation/#_2","title":"\u6e05\u534e\u955c\u50cf\u6e90\u5347\u7ea7","text":"<pre><code>pip install -U lib-pybroker -i https://pypi.tuna.tsinghua.edu.cn/simple\n</code></pre>"},{"location":"installation/#_3","title":"\u6e90\u7801\u5b89\u88c5","text":"<p>\u76ee\u524d PyBroker \u9879\u76ee\u7684\u6e90\u7801\u6258\u7ba1\u5728 GitHub \u5e73\u53f0\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u4e0b\u8f7d\u6e90\u7801\u5e76\u5b89\u88c5\uff1a</p> <pre><code>git clone https://github.com/edtechre/pybroker\ncd pybroker\npython setup.py install\n</code></pre>"},{"location":"installation/#_4","title":"\u67e5\u770b\u7248\u672c","text":"<p>\u5f53\u6210\u529f\u5b89\u88c5 PyBroker \u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u67e5\u770b\u5b89\u88c5\u7684\u7248\u672c\uff1a</p> <pre><code>import pybroker as pb\n\nprint(pb.__version__)\n</code></pre> <p>\u7ed3\u679c\u663e\u793a\uff1a</p> <pre><code>1.1.33\n</code></pre>"},{"location":"installation/#_5","title":"\u4f9d\u8d56\u5e93","text":"<p>PyBroker \u76ee\u524d\u7684\u4f9d\u8d56\u5e93\u6bd4\u8f83\u591a\uff0c \u53ef\u4ee5\u901a\u8fc7\u5b98\u7f51\u7684 requirements.txt \u67e5\u770b\u6700\u65b0\u7684\u4f9d\u8d56\uff1a</p> <pre><code>akshare&gt;=1.10.1\nalpaca-py&gt;=0.7.2\nblack&gt;=22.10.0\ndiskcache&gt;=5.4.0\nflake8&gt;=5.0.4\nflake8-bugbear&gt;=22.10.25\njoblib&gt;=1.2.0\njupyter&gt;=1.0.0\nmatplotlib&gt;=3.6.3\nmypy&gt;=0.982\nnbsphinx&gt;=0.8.11\nnumba&gt;=0.56.3\nnumpy&gt;=1.23.4\npandas&gt;=1.5.1\nprogressbar2&gt;=4.1.1\npytest&gt;=7.2.0\npytest-cov&gt;=4.0.0\npytest-instafail&gt;=0.4.2\npytest-lazy-fixture&gt;=0.6.3\npytest-randomly&gt;=3.12.0\npytest-xdist&gt;=3.0.2\nscikit-learn&gt;=1.2.1\nSphinx&gt;=5.3.0\nsphinx_rtd_theme&gt;=1.1.1\nsphinx-intl&gt;=2.1.0\nyfinance&gt;=0.1.84\n</code></pre> <p>\u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u5728\u672c\u5730\u73af\u5883\u4e2d\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u67e5\u770b\u5df2\u5b89\u88c5\u7684\u4f9d\u8d56\u5e93\uff1a</p> <pre><code>pip list\n</code></pre> <p>\u7ed3\u679c\u663e\u793a\uff1a</p> <pre><code>Package                    Version\n-------------------------- ---------\nakshare                    1.10.95\nalpaca-py                  0.8.2\nappdirs                    1.4.4\nBabel                      2.12.1\nbeautifulsoup4             4.12.2\ncertifi                    2023.7.22\ncharset-normalizer         3.2.0\nclick                      8.1.7\ncolorama                   0.4.6\ncssselect                  1.2.0\ndecorator                  5.1.1\ndiskcache                  5.6.3\net-xmlfile                 1.1.0\nfrozendict                 2.3.8\nghp-import                 2.1.0\nhtml5lib                   1.1\nidna                       3.4\nJinja2                     3.1.2\njoblib                     1.3.2\njsonpath                   0.82.2\nlib-pybroker               1.1.29\nllvmlite                   0.40.1\nlxml                       4.9.3\nMarkdown                   3.4.4\nmarkdown2                  2.4.10\nMarkupSafe                 2.1.3\nmergedeep                  1.3.4\nmkdocs                     1.5.2\nmkdocs-material            9.2.6\nmkdocs-material-extensions 1.1.1\nmsgpack                    1.0.5\nmultitasking               0.0.11\nnumba                      0.57.1\nnumpy                      1.24.4\nopenpyxl                   3.1.2\npackaging                  23.1\npaginate                   0.5.6\npandas                     1.5.3\npathspec                   0.11.2\npip                        23.2.1\nplatformdirs               3.10.0\nprogressbar2               4.2.0\npy-mini-racer              0.6.0\npydantic                   1.10.12\nPygments                   2.16.1\npymdown-extensions         10.2.1\npypinyin                   0.49.0\npyquery                    2.0.0\npython-dateutil            2.8.2\npython-utils               3.7.0\npytz                       2023.3\nPyYAML                     6.0.1\npyyaml_env_tag             0.1\nreadtime                   3.0.0\nregex                      2023.8.8\nrequests                   2.31.0\nsetuptools                 68.0.0\ntabulate                   0.9.0\ntqdm                       4.66.1\ntyping_extensions          4.7.1\nurllib3                    2.0.4\nwatchdog                   3.0.0\nwebencodings               0.5.1\nwebsockets                 10.4\nwheel                      0.38.4\nxlrd                       2.0.1\nyfinance                   0.2.28\n</code></pre>"},{"location":"installation/#_6","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>PyBroker PyPI</li> <li>PyBroker GitHub</li> <li>\u6e05\u534e\u955c\u50cf\u6e90</li> </ul>"},{"location":"quant-resource/","title":"\u91cf\u5316\u6295\u8d44\u53c2\u8003\u8d44\u6599","text":""},{"location":"quant-resource/#_2","title":"\u5b66\u4e60\u8d44\u6e90","text":"<ol> <li>Build powerful Trading Strategies with Artificial Intelligence</li> <li>Quantitative Trading</li> <li>Quantitative Economics</li> <li>Quantocracy</li> </ol>"},{"location":"quickstart/","title":"\u5feb\u901f\u5f00\u59cb","text":"<p>\u5728\u6b64\u5904\u901a\u8fc7\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\u6765\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 <code>pybroker</code> \u6765\u5f00\u53d1\u7b56\u7565\u3002</p>"},{"location":"quickstart/#_2","title":"\u5bfc\u5165\u76f8\u5173\u7684\u6a21\u5757\u548c\u7c7b","text":"<pre><code>import pybroker as pb\nfrom pybroker import Strategy, StrategyConfig, ExecContext\nfrom pybroker.ext.data import AKShare\n\nprint(pb.__version__)\n</code></pre> <ol> <li>\u5c06 <code>pybroker</code> \u6a21\u5757\u5bfc\u5165\u4e3a <code>pb</code>\uff0c\u8fd9\u662f\u4e00\u4e2a\u7ea6\u5b9a\u4fd7\u6210\u7684\u505a\u6cd5\uff0c\u65b9\u4fbf\u540e\u7eed\u4f7f\u7528\u3002</li> <li>\u4ece <code>pybroker</code> \u4e2d\u5bfc\u5165 <code>Strategy</code> \u548c <code>StrategyConfig</code> \u7c7b\uff0c\u4ee5\u53ca <code>AKShare</code> \u6570\u636e\u6e90\u3002</li> <li><code>Strategy</code> \u7c7b\u662f pybroker \u4e2d\u7684\u7b56\u7565\u57fa\u7c7b\uff0c\u6240\u6709\u7684\u7b56\u7565\u90fd\u9700\u8981\u7ee7\u627f\u8be5\u7c7b\u3002</li> <li><code>StrategyConfig</code> \u7c7b\u662f pybroker \u4e2d\u7684\u7b56\u7565\u914d\u7f6e\u57fa\u7c7b\uff0c\u6240\u6709\u7684\u7b56\u7565\u914d\u7f6e\u90fd\u9700\u8981\u7ee7\u627f\u8be5\u7c7b\u3002</li> <li><code>AKShare</code> \u7c7b\u662f pybroker \u4e2d\u7684\u6570\u636e\u6e90\u7c7b\uff0c\u7528\u4e8e\u83b7\u53d6\u6570\u636e\u3002</li> <li><code>pb.__version__</code> \u5c5e\u6027\u7528\u4e8e\u83b7\u53d6 pybroker \u7684\u7248\u672c\u3002</li> </ol>"},{"location":"quickstart/#_3","title":"\u914d\u7f6e\u7b56\u7565","text":"<pre><code>config = StrategyConfig(initial_cash=500_000)\n</code></pre> <ol> <li>\u521b\u5efa\u4e00\u4e2a\u7b56\u7565\u914d\u7f6e\u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u7528\u4e8e\u914d\u7f6e\u7b56\u7565\u7684\u4e00\u4e9b\u53c2\u6570\u3002</li> <li><code>initial_cash</code> \u53c2\u6570\u7528\u4e8e\u914d\u7f6e\u7b56\u7565\u7684\u521d\u59cb\u8d44\u91d1\uff0c\u9ed8\u8ba4\u4e3a 10 \u4e07\u3002</li> </ol> <pre><code>strategy = Strategy(\n    data_source=AKShare(),\n    start_date='20220101',\n    end_date='20230916',\n    config=config\n)\n</code></pre> <ol> <li>\u521b\u5efa\u4e00\u4e2a\u7b56\u7565\u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u7528\u4e8e\u8fd0\u884c\u7b56\u7565\u3002</li> <li><code>AKShare()</code> \u53c2\u6570\u7528\u4e8e\u914d\u7f6e\u7b56\u7565\u7684\u6570\u636e\u6e90\uff0c\u8be5\u6570\u636e\u6e90\u4e3a akshare\u3002</li> <li><code>20220101</code> \u53c2\u6570\u7528\u4e8e\u914d\u7f6e\u7b56\u7565\u7684\u5f00\u59cb\u65e5\u671f\u3002</li> <li><code>20230916</code> \u53c2\u6570\u7528\u4e8e\u914d\u7f6e\u7b56\u7565\u7684\u7ed3\u675f\u65e5\u671f\u3002</li> <li><code>config</code> \u53c2\u6570\u7528\u4e8e\u914d\u7f6e\u7b56\u7565\u7684\u914d\u7f6e\u5bf9\u8c61\u3002</li> <li><code>strategy</code> \u5bf9\u8c61\u7528\u4e8e\u8fd0\u884c\u7b56\u7565\u3002</li> <li><code>strategy</code> \u5bf9\u8c61\u7684 <code>config</code> \u5c5e\u6027\u7528\u4e8e\u83b7\u53d6\u7b56\u7565\u7684\u914d\u7f6e\u5bf9\u8c61\u3002</li> </ol>"},{"location":"quickstart/#_4","title":"\u5b9a\u4e49\u89c4\u5219","text":"<pre><code>def buy_low(ctx: ExecContext):\n    # \u5982\u679c\u5f53\u524d\u5df2\u7ecf\u6301\u6709\u4ed3\u4f4d\uff0c\u5219\u4e0d\u518d\u4e70\u5165\u3002\n    if ctx.long_pos():\n        return\n    # \u5982\u679c\u5f53\u524d\u7684\u6536\u76d8\u4ef7\u5c0f\u4e8e\u524d\u4e00\u5929\u7684\u6700\u4f4e\u4ef7\uff0c\u5219\u4e0b\u5355\u4e70\u5165\u3002\n    if ctx.bars &gt;= 2 and ctx.close[-1] &lt; ctx.low[-2]:\n        # \u8ba1\u7b97\u4e70\u5165\u7684\u80a1\u7968\u6570\u91cf\uff0c\u8be5\u6570\u91cf\u4e3a\u5f53\u524d\u8d44\u91d1\u7684 25%\u3002\n        ctx.buy_shares = ctx.calc_target_shares(0.25)\n        # \u8bbe\u7f6e\u4e70\u5165\u7684\u9650\u4ef7\uff0c\u8be5\u9650\u4ef7\u4e3a\u5f53\u524d\u6536\u76d8\u4ef7\u51cf\u53bb 0.01\u3002\n        ctx.buy_limit_price = ctx.close[-1] - 0.01\n        # \u8bbe\u7f6e\u6301\u6709\u4ed3\u4f4d\u7684\u65f6\u95f4\uff0c\u8be5\u65f6\u95f4\u4e3a 3 \u4e2a\u4ea4\u6613\u65e5\u3002\n        ctx.hold_bars = 3\n</code></pre> <ol> <li>\u5b9a\u4e49\u4e00\u4e2a\u540d\u4e3a <code>buy_low</code> \u7684\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u7528\u4e8e\u5224\u65ad\u662f\u5426\u9700\u8981\u4e70\u5165\u3002</li> <li><code>ctx</code> \u53c2\u6570\u662f\u4e00\u4e2a\u4e0a\u4e0b\u6587\u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u5305\u542b\u4e86\u7b56\u7565\u8fd0\u884c\u65f6\u7684\u4e00\u4e9b\u6570\u636e\u3002</li> <li><code>ctx.long_pos()</code> \u65b9\u6cd5\u7528\u4e8e\u5224\u65ad\u662f\u5426\u5df2\u7ecf\u6301\u6709\u4ed3\u4f4d\u3002</li> <li><code>ctx.bars</code> \u5c5e\u6027\u7528\u4e8e\u83b7\u53d6\u5f53\u524d\u7684\u4ea4\u6613\u65e5\u3002</li> </ol>"},{"location":"quickstart/#_5","title":"\u8fd0\u884c\u7b56\u7565","text":"<p>\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528 <code>strategy.backtest()</code> \u65b9\u6cd5\u6765\u8fdb\u884c\u7b56\u7565\u56de\u6d4b\uff1a</p> <pre><code>strategy.add_execution(fn=buy_low, symbols=['000001', '600000'])\nresult = strategy.backtest()\n</code></pre>"},{"location":"quickstart/#_6","title":"\u67e5\u770b\u7ed3\u679c","text":""},{"location":"quickstart/#_7","title":"\u67e5\u770b\u7ee9\u6548","text":"<pre><code>print(result.metrics_df)\n</code></pre> <pre><code>                      name         value\n0              trade_count  6.000000e+01\n1     initial_market_value  5.000000e+05\n2         end_market_value  4.807408e+05\n3                total_pnl -1.925923e+04\n4           unrealized_pnl  1.818989e-11\n5         total_return_pct -3.851846e+00\n6             total_profit  4.150577e+04\n7               total_loss -6.076500e+04\n8               total_fees  0.000000e+00\n9             max_drawdown -3.168807e+04\n10        max_drawdown_pct -6.280127e+00\n11                win_rate  4.745763e+01\n12               loss_rate  5.254237e+01\n13          winning_trades  2.800000e+01\n14           losing_trades  3.100000e+01\n15                 avg_pnl -3.209872e+02\n16          avg_return_pct -2.623333e-01\n17          avg_trade_bars  3.000000e+00\n18              avg_profit  1.482349e+03\n19          avg_profit_pct  1.242857e+00\n20  avg_winning_trade_bars  3.000000e+00\n21                avg_loss -1.960161e+03\n22            avg_loss_pct -1.630323e+00\n23   avg_losing_trade_bars  3.000000e+00\n24             largest_win  4.888940e+03\n25         largest_win_pct  4.060000e+00\n26        largest_win_bars  3.000000e+00\n27            largest_loss -7.065140e+03\n28        largest_loss_pct -5.780000e+00\n29       largest_loss_bars  3.000000e+00\n30                max_wins  3.000000e+00\n31              max_losses  5.000000e+00\n32                  sharpe -4.184734e-02\n33                 sortino -4.060695e-02\n34           profit_factor  8.291367e-01\n35             ulcer_index  6.942926e-01\n36                     upi -1.328477e-02\n37               equity_r2  6.199979e-01\n38               std_error  6.892189e+03\n</code></pre>"},{"location":"quickstart/#_8","title":"\u67e5\u770b\u8ba2\u5355","text":"<pre><code>print(result.orders)\n</code></pre> <pre><code>     type  symbol       date  shares  limit_price  fill_price  fees\nid\n1     buy  000001 2022-01-17      44      2822.91     2818.04   0.0\n2    sell  000001 2022-01-20      44          NaN     2922.06   0.0\n3     buy  000001 2022-01-25      42      2964.31     2922.88   0.0\n4     buy  600000 2022-01-25    1497        84.20       83.74   0.0\n5    sell  000001 2022-01-28      42          NaN     2791.23   0.0\n..    ...     ...        ...     ...          ...         ...   ...\n116  sell  000001 2023-08-29      57          NaN     2090.42   0.0\n117   buy  000001 2023-08-30      57      2090.40     2072.54   0.0\n118   buy  600000 2023-08-30    1525        78.33       78.24   0.0\n119  sell  000001 2023-09-04      57          NaN     2114.79   0.0\n120  sell  600000 2023-09-04    1525          NaN       78.44   0.0\n[120 rows x 7 columns]\n</code></pre>"},{"location":"quickstart/#_9","title":"\u67e5\u770b\u6301\u4ed3","text":"<pre><code>print(result.positions)\n</code></pre> <pre><code>                   long_shares  short_shares  ...  margin  unrealized_pnl\nsymbol date                                   ...\n000001 2022-01-17           44             0  ...     0.0         -572.00\n       2022-01-18           44             0  ...     0.0         1573.44\n       2022-01-19           44             0  ...     0.0         1430.44\n600000 2022-01-25         1497             0  ...     0.0         -583.83\n000001 2022-01-25           42             0  ...     0.0         -648.48\n                        ...           ...  ...     ...             ...\n       2023-08-30           57             0  ...     0.0         -648.66\n600000 2023-08-31         1525             0  ...     0.0         -762.50\n000001 2023-08-31           57             0  ...     0.0         -648.66\n600000 2023-09-01         1525             0  ...     0.0         -457.50\n000001 2023-09-01           57             0  ...     0.0         1111.50\n[180 rows x 7 columns]\n</code></pre>"},{"location":"quickstart/#_10","title":"\u67e5\u770b\u6295\u8d44\u7ec4\u5408","text":"<pre><code>print(result.portfolio)\n</code></pre> <pre><code>                 cash     equity  margin  ...       pnl  unrealized_pnl  fees\ndate                                      ...\n2022-01-04  500000.00  500000.00     0.0  ...      0.00             0.0   0.0\n2022-01-05  500000.00  500000.00     0.0  ...      0.00             0.0   0.0\n2022-01-06  500000.00  500000.00     0.0  ...      0.00             0.0   0.0\n2022-01-07  500000.00  500000.00     0.0  ...      0.00             0.0   0.0\n2022-01-10  500000.00  500000.00     0.0  ...      0.00             0.0   0.0\n               ...        ...     ...  ...       ...             ...   ...\n2023-09-11  480740.77  480740.77     0.0  ... -19259.23             0.0   0.0\n2023-09-12  480740.77  480740.77     0.0  ... -19259.23             0.0   0.0\n2023-09-13  480740.77  480740.77     0.0  ... -19259.23             0.0   0.0\n2023-09-14  480740.77  480740.77     0.0  ... -19259.23             0.0   0.0\n2023-09-15  480740.77  480740.77     0.0  ... -19259.23             0.0   0.0\n[415 rows x 7 columns]\n</code></pre>"},{"location":"quickstart/#_11","title":"\u67e5\u770b\u4ea4\u6613","text":"<pre><code>print(result.trades)\n</code></pre> <pre><code>    type  symbol entry_date  exit_date  ...   agg_pnl  bars  pnl_per_bar  stop\nid                                      ...\n1   long  000001 2022-01-17 2022-01-20  ...   4576.88     3      1525.63   bar\n2   long  000001 2022-01-25 2022-01-28  ...   -952.42     3     -1843.10   bar\n3   long  600000 2022-01-25 2022-01-28  ...  -2524.27     3      -523.95   bar\n4   long  000001 2022-02-15 2022-02-18  ...  -1441.10     3       361.06   bar\n5   long  600000 2022-02-15 2022-02-18  ...  -1188.31     3        84.26   bar\n6   long  000001 2022-02-23 2022-02-28  ...  -4084.39     3      -965.36   bar\n7   long  000001 2022-03-07 2022-03-10  ...  -7784.63     3     -1233.41   bar\n8   long  600000 2022-03-07 2022-03-10  ... -11308.67     3     -1174.68   bar\n9   long  000001 2022-04-12 2022-04-15  ...  -9666.50     3       547.39   bar\n10  long  600000 2022-04-22 2022-04-27  ... -11531.88     3      -621.79   bar\n11  long  000001 2022-04-26 2022-04-29  ...  -6642.94     3      1629.65   bar\n12  long  000001 2022-05-05 2022-05-10  ... -13708.08     3     -2355.05   bar\n13  long  600000 2022-05-09 2022-05-12  ... -13302.74     3       135.11   bar\n14  long  000001 2022-05-25 2022-05-30  ... -15136.34     3      -611.20   bar\n15  long  000001 2022-06-06 2022-06-09  ... -12149.79     3       995.52   bar\n16  long  600000 2022-07-04 2022-07-07  ... -12961.75     3      -270.65   bar\n17  long  000001 2022-07-07 2022-07-12  ... -12649.75     3       104.00   bar\n18  long  000001 2022-07-14 2022-07-19  ... -13804.68     3      -384.98   bar\n19  long  600000 2022-07-14 2022-07-19  ... -13897.56     3       -30.96   bar\n20  long  000001 2022-07-22 2022-07-27  ... -13638.92     3        86.21   bar\n21  long  000001 2022-08-01 2022-08-04  ... -17386.55     3     -1249.21   bar\n22  long  600000 2022-08-01 2022-08-04  ... -19096.76     3      -570.07   bar\n23  long  000001 2022-08-30 2022-09-02  ... -17780.24     3       438.84   bar\n24  long  000001 2022-09-05 2022-09-08  ... -18770.81     3      -330.19   bar\n25  long  000001 2022-09-27 2022-09-30  ... -19576.01     3      -268.40   bar\n26  long  600000 2022-09-27 2022-09-30  ... -19844.44     3       -89.48   bar\n27  long  000001 2022-10-20 2022-10-25  ... -24840.56     3     -1665.37   bar\n28  long  600000 2022-10-24 2022-10-27  ... -25142.66     3      -100.70   bar\n29  long  000001 2022-10-31 2022-11-03  ... -23732.16     3       470.17   bar\n30  long  600000 2022-10-31 2022-11-03  ... -23891.56     3       -53.13   bar\n31  long  000001 2022-11-17 2022-11-22  ... -24114.86     3       -74.43   bar\n32  long  600000 2022-11-18 2022-11-23  ... -23060.95     3       351.30   bar\n33  long  600000 2022-12-26 2022-12-29  ... -22132.15     3       309.60   bar\n34  long  000001 2023-02-02 2023-02-07  ... -24748.17     3      -872.01   bar\n35  long  600000 2023-02-02 2023-02-07  ... -25848.33     3      -366.72   bar\n36  long  000001 2023-02-17 2023-02-22  ... -22225.27     3      1207.69   bar\n37  long  600000 2023-02-24 2023-03-01  ... -22225.27     3         0.00   bar\n38  long  000001 2023-02-27 2023-03-02  ... -18559.03     3      1222.08   bar\n39  long  000001 2023-03-08 2023-03-13  ... -21546.07     3      -995.68   bar\n40  long  600000 2023-03-13 2023-03-16  ... -21031.93     3       171.38   bar\n41  long  000001 2023-03-20 2023-03-23  ... -20482.29     3       183.21   bar\n42  long  000001 2023-04-12 2023-04-17  ... -18328.90     3       717.80   bar\n43  long  000001 2023-04-20 2023-04-25  ... -22681.82     3     -1450.97   bar\n44  long  600000 2023-05-15 2023-05-18  ... -21994.58     3       229.08   bar\n45  long  000001 2023-05-24 2023-05-29  ... -22608.56     3      -204.66   bar\n46  long  600000 2023-05-24 2023-05-29  ... -22411.35     3        65.74   bar\n47  long  000001 2023-05-31 2023-06-05  ... -20623.85     3       595.83   bar\n48  long  000001 2023-06-13 2023-06-16  ... -19349.29     3       424.85   bar\n49  long  000001 2023-06-20 2023-06-27  ... -20805.29     3      -485.33   bar\n50  long  600000 2023-06-20 2023-06-27  ... -22283.69     3      -492.80   bar\n51  long  000001 2023-07-07 2023-07-12  ... -21681.77     3       200.64   bar\n52  long  000001 2023-07-18 2023-07-21  ... -21079.85     3       200.64   bar\n53  long  000001 2023-08-02 2023-08-07  ... -20218.60     3       287.08   bar\n54  long  000001 2023-08-08 2023-08-11  ... -20433.78     3       -71.73   bar\n55  long  600000 2023-08-08 2023-08-11  ... -21923.53     3      -496.58   bar\n56  long  000001 2023-08-14 2023-08-17  ... -22844.77     3      -307.08   bar\n57  long  600000 2023-08-14 2023-08-17  ... -23130.72     3       -95.32   bar\n58  long  000001 2023-08-24 2023-08-29  ... -21972.48     3       386.08   bar\n59  long  000001 2023-08-30 2023-09-04  ... -19564.23     3       802.75   bar\n60  long  600000 2023-08-30 2023-09-04  ... -19259.23     3       101.67   bar\n[60 rows x 13 columns]\n</code></pre>"},{"location":"quickstart/#_12","title":"\u7b56\u7565\u4ee3\u7801","text":"<pre><code># \u5bfc\u5165\u76f8\u5173\u6a21\u5757\u548c\u7c7b\nimport pybroker as pb\nfrom pybroker import Strategy, StrategyConfig, ExecContext\nfrom pybroker.ext.data import AKShare\n\n# \u67e5\u770b\u5f53\u524d\u7248\u672c\nprint(pb.__version__)\n\n# \u7b56\u7565\u914d\u7f6e\nconfig = StrategyConfig(initial_cash=500_000)\nstrategy = Strategy(\n    data_source=AKShare(),\n    start_date='20220101',\n    end_date='20230916',\n    config=config\n)\n\n# \u5b9a\u4e49\u89c4\u5219\ndef buy_low(ctx: ExecContext):\n    # \u5982\u679c\u5f53\u524d\u5df2\u7ecf\u6301\u6709\u4ed3\u4f4d\uff0c\u5219\u4e0d\u518d\u4e70\u5165\u3002\n    if ctx.long_pos():\n        return\n    # \u5982\u679c\u5f53\u524d\u7684\u6536\u76d8\u4ef7\u5c0f\u4e8e\u524d\u4e00\u5929\u7684\u6700\u4f4e\u4ef7\uff0c\u5219\u4e0b\u5355\u4e70\u5165\u3002\n    if ctx.bars &gt;= 2 and ctx.close[-1] &lt; ctx.low[-2]:\n        # \u8ba1\u7b97\u4e70\u5165\u7684\u80a1\u7968\u6570\u91cf\uff0c\u8be5\u6570\u91cf\u4e3a\u5f53\u524d\u8d44\u91d1\u7684 25%\u3002\n        ctx.buy_shares = ctx.calc_target_shares(0.25)\n        # \u8bbe\u7f6e\u4e70\u5165\u7684\u9650\u4ef7\uff0c\u8be5\u9650\u4ef7\u4e3a\u5f53\u524d\u6536\u76d8\u4ef7\u51cf\u53bb 0.01\u3002\n        ctx.buy_limit_price = ctx.close[-1] - 0.01\n        # \u8bbe\u7f6e\u6301\u6709\u4ed3\u4f4d\u7684\u65f6\u95f4\uff0c\u8be5\u65f6\u95f4\u4e3a 3 \u4e2a\u4ea4\u6613\u65e5\u3002\n        ctx.hold_bars = 3\n\n# \u6267\u884c\u56de\u6d4b\nstrategy.add_execution(fn=buy_low, symbols=['000001', '600000'])\nresult = strategy.backtest()\n\n# \u67e5\u770b\u7ed3\u679c\nprint(result.metrics_df)  # \u67e5\u770b\u7ee9\u6548\nprint(result.orders)  # \u67e5\u770b\u8ba2\u5355\nprint(result.positions)  # \u67e5\u770b\u6301\u4ed3\nprint(result.portfolio)  # \u67e5\u770b\u6295\u8d44\u7ec4\u5408\nprint(result.trades)  # \u67e5\u770b\u4ea4\u6613\n</code></pre>"}]}